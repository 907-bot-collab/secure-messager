<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureChat - Private Messaging</title>
    <style>
      :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08); /* Light blue */
  --color-bg-2: rgba(245, 158, 11, 0.08); /* Light yellow */
  --color-bg-3: rgba(34, 197, 94, 0.08); /* Light green */
  --color-bg-4: rgba(239, 68, 68, 0.08); /* Light red */
  --color-bg-5: rgba(147, 51, 234, 0.08); /* Light purple */
  --color-bg-6: rgba(249, 115, 22, 0.08); /* Light orange */
  --color-bg-7: rgba(236, 72, 153, 0.08); /* Light pink */
  --color-bg-8: rgba(6, 182, 212, 0.08); /* Light cyan */

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    /* RGB versions for opacity control (Dark Mode) */
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
    --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
    --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
    --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
    --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
    --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
    --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
    --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --button-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* Common style patterns - updated for dark mode */
    --focus-ring: 0 0 0 3px var(--color-focus-ring);
    --focus-outline: 2px solid var(--color-primary);
    --status-bg-opacity: 0.15;
    --status-border-opacity: 0.25;
    --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

/* Data attribute for manual theme switching */
[data-color-scheme="dark"] {
  /* RGB versions for opacity control (dark mode) */
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;

  /* Colorful background palette - Dark Mode */
  --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
  --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
  --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
  --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
  --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
  --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
  --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
  --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

  /* Semantic Color Tokens (Dark Mode) */
  --color-background: var(--color-charcoal-700);
  --color-surface: var(--color-charcoal-800);
  --color-text: var(--color-gray-200);
  --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
  --color-primary: var(--color-teal-300);
  --color-primary-hover: var(--color-teal-400);
  --color-primary-active: var(--color-teal-800);
  --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
  --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
  --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
  --color-border: rgba(var(--color-gray-400-rgb), 0.3);
  --color-error: var(--color-red-400);
  --color-success: var(--color-teal-300);
  --color-warning: var(--color-orange-400);
  --color-info: var(--color-gray-300);
  --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
  --color-btn-primary-text: var(--color-slate-900);
  --color-card-border: rgba(var(--color-gray-400-rgb), 0.15);
  --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
  --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

  /* Common style patterns - updated for dark mode */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for dark mode */
  --color-success-rgb: var(--color-teal-300-rgb);
  --color-error-rgb: var(--color-red-400-rgb);
  --color-warning-rgb: var(--color-orange-400-rgb);
  --color-info-rgb: var(--color-gray-300-rgb);
}

[data-color-scheme="light"] {
  /* RGB versions for opacity control (light mode) */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

  /* RGB versions for light mode */
  --color-success-rgb: var(--color-teal-500-rgb);
  --color-error-rgb: var(--color-red-500-rgb);
  --color-warning-rgb: var(--color-orange-500-rgb);
  --color-info-rgb: var(--color-slate-500-rgb);
}

/* Base styles */
html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}
h4 {
  font-size: var(--font-size-xl);
}
h5 {
  font-size: var(--font-size-lg);
}
h6 {
  font-size: var(--font-size-md);
}

p {
  margin: 0 0 var(--space-16) 0;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--duration-fast) var(--ease-standard);
}

a:hover {
  color: var(--color-primary-hover);
}

code,
pre {
  font-family: var(--font-family-mono);
  font-size: calc(var(--font-size-base) * 0.95);
  background-color: var(--color-secondary);
  border-radius: var(--radius-sm);
}

code {
  padding: var(--space-1) var(--space-4);
}

pre {
  padding: var(--space-16);
  margin: var(--space-16) 0;
  overflow: auto;
  border: 1px solid var(--color-border);
}

pre code {
  background: none;
  padding: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--secondary:active {
  background: var(--color-secondary-active);
}

.btn--outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text);
}

.btn--outline:hover {
  background: var(--color-secondary);
}

.btn--sm {
  padding: var(--space-4) var(--space-12);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-sm);
}

.btn--lg {
  padding: var(--space-10) var(--space-20);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-md);
}

.btn--full-width {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Form elements */
.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

textarea.form-control {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
}

select.form-control {
  padding: var(--space-8) var(--space-12);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

/* Add a dark mode specific caret */
@media (prefers-color-scheme: dark) {
  select.form-control {
    background-image: var(--select-caret-dark);
  }
}

/* Also handle data-color-scheme */
[data-color-scheme="dark"] select.form-control {
  background-image: var(--select-caret-dark);
}

[data-color-scheme="light"] select.form-control {
  background-image: var(--select-caret-light);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

/* Card component */
.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.card:hover {
  box-shadow: var(--shadow-md);
}

.card__body {
  padding: var(--space-16);
}

.card__header,
.card__footer {
  padding: var(--space-16);
  border-bottom: 1px solid var(--color-card-border-inner);
}

/* Status indicators - simplified with CSS variables */
.status {
  display: inline-flex;
  align-items: center;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.status--success {
  background-color: rgba(
    var(--color-success-rgb, 33, 128, 141),
    var(--status-bg-opacity)
  );
  color: var(--color-success);
  border: 1px solid
    rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
}

.status--error {
  background-color: rgba(
    var(--color-error-rgb, 192, 21, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-error);
  border: 1px solid
    rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
}

.status--warning {
  background-color: rgba(
    var(--color-warning-rgb, 168, 75, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-warning);
  border: 1px solid
    rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
}

.status--info {
  background-color: rgba(
    var(--color-info-rgb, 98, 108, 113),
    var(--status-bg-opacity)
  );
  color: var(--color-info);
  border: 1px solid
    rgba(var(--color-info-rgb, 98, 108, 113), var(--status-border-opacity));
}

/* Container layout */
.container {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--space-16);
  padding-left: var(--space-16);
}

@media (min-width: 640px) {
  .container {
    max-width: var(--container-sm);
  }
}
@media (min-width: 768px) {
  .container {
    max-width: var(--container-md);
  }
}
@media (min-width: 1024px) {
  .container {
    max-width: var(--container-lg);
  }
}
@media (min-width: 1280px) {
  .container {
    max-width: var(--container-xl);
  }
}

/* Utility classes */
.flex {
  display: flex;
}
.flex-col {
  flex-direction: column;
}
.items-center {
  align-items: center;
}
.justify-center {
  justify-content: center;
}
.justify-between {
  justify-content: space-between;
}
.gap-4 {
  gap: var(--space-4);
}
.gap-8 {
  gap: var(--space-8);
}
.gap-16 {
  gap: var(--space-16);
}

.m-0 {
  margin: 0;
}
.mt-8 {
  margin-top: var(--space-8);
}
.mb-8 {
  margin-bottom: var(--space-8);
}
.mx-8 {
  margin-left: var(--space-8);
  margin-right: var(--space-8);
}
.my-8 {
  margin-top: var(--space-8);
  margin-bottom: var(--space-8);
}

.p-0 {
  padding: 0;
}
.py-8 {
  padding-top: var(--space-8);
  padding-bottom: var(--space-8);
}
.px-8 {
  padding-left: var(--space-8);
  padding-right: var(--space-8);
}
.py-16 {
  padding-top: var(--space-16);
  padding-bottom: var(--space-16);
}
.px-16 {
  padding-left: var(--space-16);
  padding-right: var(--space-16);
}

.block {
  display: block;
}
.hidden {
  display: none;
}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
}

/* Dark mode specifics */
[data-color-scheme="dark"] .btn--outline {
  border: 1px solid var(--color-border-secondary);
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

/* END PERPLEXITY DESIGN SYSTEM */
/* Login Page Styles */
.login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-1);
  padding: var(--space-16);
}

.login-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-32);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--color-card-border);
  width: 100%;
  max-width: 400px;
}

.login-header {
  text-align: center;
  margin-bottom: var(--space-32);
}

.login-header h1 {
  color: var(--color-primary);
  margin-bottom: var(--space-8);
}

.login-header p {
  color: var(--color-text-secondary);
  margin: 0;
}

.login-form {
  margin-bottom: var(--space-16);
}

.login-info {
  text-align: center;
  padding: var(--space-12);
  background: var(--color-bg-2);
  border-radius: var(--radius-base);
  border: 1px solid var(--color-border);
}

.login-info small {
  color: var(--color-text-secondary);
}

/* Main App Styles */
.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--color-background);
}

.app-header {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-16) var(--space-24);
  box-shadow: var(--shadow-sm);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: var(--container-xl);
  margin: 0 auto;
}

.header-left {
  display: flex;
  align-items: center;
  gap: var(--space-16);
}

.header-left h2 {
  color: var(--color-primary);
  margin: 0;
}

.header-right {
  display: flex;
  align-items: center;
  gap: var(--space-12);
}

.user-badge {
  background: var(--color-secondary);
  color: var(--color-text);
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
}

/* App Content Layout */
.app-content {
  flex: 1;
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 0;
  max-width: var(--container-xl);
  margin: 0 auto;
  width: 100%;
}

@media (max-width: 768px) {
  .app-content {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr auto;
  }
}

/* Chat Section */
.chat-section {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 80px);
  border-right: 1px solid var(--color-border);
  background: var(--color-surface);
}

.chat-header {
  padding: var(--space-16) var(--space-24);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-background);
}

.chat-header h3 {
  margin: 0 0 var(--space-8) 0;
}

.typing-indicator {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-style: italic;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-16);
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.welcome-message {
  text-align: center;
  background: var(--color-bg-3);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  margin-bottom: var(--space-16);
}

.welcome-message p {
  margin: 0;
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

.message {
  max-width: 70%;
  margin-bottom: var(--space-12);
}

.message--sent {
  align-self: flex-end;
}

.message--received {
  align-self: flex-start;
}

.message-bubble {
  padding: var(--space-12) var(--space-16);
  border-radius: var(--radius-lg);
  word-wrap: break-word;
  position: relative;
}

.message--sent .message-bubble {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.message--received .message-bubble {
  background: var(--color-secondary);
  color: var(--color-text);
}

.message-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin-top: var(--space-6);
}

.message-form {
  padding: var(--space-16) var(--space-24);
  border-top: 1px solid var(--color-border);
  background: var(--color-background);
}

.message-input-container {
  display: flex;
  gap: var(--space-12);
  align-items: flex-end;
}

.message-input {
  flex: 1;
  resize: none;
  min-height: 40px;
  max-height: 120px;
}

.message-send-btn {
  white-space: nowrap;
}

/* Instagram Section */
.instagram-section {
  background: var(--color-surface);
  border-left: 1px solid var(--color-border);
  height: calc(100vh - 80px);
  overflow-y: auto;
}

.instagram-header {
  padding: var(--space-16) var(--space-20);
  border-bottom: 1px solid var(--color-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-background);
  position: sticky;
  top: 0;
  z-index: 10;
}

.instagram-header h3 {
  margin: 0;
}

.instagram-disconnected {
  padding: var(--space-20);
}

.instagram-connect {
  text-align: center;
}

.instagram-connect p {
  color: var(--color-text-secondary);
  margin-bottom: var(--space-16);
}

.instagram-connected {
  padding: var(--space-20);
}

.instagram-profile {
  background: var(--color-bg-6);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  margin-bottom: var(--space-20);
}

.instagram-profile-info {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.instagram-username {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.instagram-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-8);
  font-size: var(--font-size-sm);
}

.instagram-stat {
  text-align: center;
  color: var(--color-text-secondary);
}

.instagram-stat-value {
  display: block;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  font-size: var(--font-size-md);
}

.instagram-posts h4 {
  margin: 0 0 var(--space-16) 0;
  color: var(--color-text);
}

.instagram-feed {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.instagram-post {
  background: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.instagram-post:hover {
  box-shadow: var(--shadow-md);
}

.instagram-post-header {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-12);
}

.instagram-post-type {
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  font-weight: var(--font-weight-semibold);
  padding: var(--space-2) var(--space-6);
  border-radius: var(--radius-sm);
}

.instagram-post-type--image {
  background: var(--color-bg-3);
  color: var(--color-success);
}

.instagram-post-type--reel {
  background: var(--color-bg-4);
  color: var(--color-error);
}

.instagram-post-thumbnail {
  width: 100%;
  height: 200px;
  object-fit: cover;
  display: block;
}

.instagram-post-content {
  padding: var(--space-12);
}

.instagram-post-caption {
  font-size: var(--font-size-sm);
  color: var(--color-text);
  margin-bottom: var(--space-12);
  line-height: var(--line-height-normal);
}

.instagram-post-stats {
  display: flex;
  gap: var(--space-16);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

.instagram-loading {
  padding: var(--space-32);
  text-align: center;
  color: var(--color-text-secondary);
}

/* Error Messages */
.error-message {
  background: var(--color-bg-4);
  color: var(--color-error);
  padding: var(--space-12);
  border-radius: var(--radius-base);
  border: 1px solid rgba(var(--color-error-rgb), 0.3);
  margin-top: var(--space-16);
  font-size: var(--font-size-sm);
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(var(--color-slate-900-rgb), 0.8);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  color: var(--color-white);
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top: 3px solid var(--color-white);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: var(--space-16);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .login-card {
    padding: var(--space-24);
  }

  .app-header {
    padding: var(--space-12) var(--space-16);
  }

  .header-content {
    flex-direction: column;
    gap: var(--space-12);
    align-items: flex-start;
  }

  .header-right {
    align-self: flex-end;
  }

  .chat-section {
    height: 60vh;
  }

  .instagram-section {
    height: 40vh;
    border-left: none;
    border-top: 1px solid var(--color-border);
  }

  .message-input-container {
    flex-direction: column;
    gap: var(--space-8);
  }

  .message-send-btn {
    align-self: flex-end;
  }
}

/* Utility Classes */
.hidden {
  display: none !important;
}

/* Scrollbar Styling */
.chat-messages::-webkit-scrollbar,
.instagram-section::-webkit-scrollbar {
  width: 6px;
}

.chat-messages::-webkit-scrollbar-track,
.instagram-section::-webkit-scrollbar-track {
  background: var(--color-background);
}

.chat-messages::-webkit-scrollbar-thumb,
.instagram-section::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-full);
}

.chat-messages::-webkit-scrollbar-thumb:hover,
.instagram-section::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>SecureChat</h1>
                <p>Private messaging for two</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" name="username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" name="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn--primary btn--full-width">Login</button>
            </form>
            <div id="loginError" class="error-message hidden"></div>
            <div class="login-info">
                <small>Demo Credentials: user1/pass1 or user2/pass2</small>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="app-container hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h2>SecureChat</h2>
                    <span id="currentUser" class="user-badge"></span>
                </div>
                <div class="header-right">
                    <span id="onlineStatus" class="status status--success">Online</span>
                    <button id="logoutBtn" class="btn btn--outline btn--sm">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="app-content">
            <!-- Chat Section -->
            <div class="chat-section">
                <div class="chat-header">
                    <h3>Private Chat</h3>
                    <div id="typingIndicator" class="typing-indicator hidden">
                        <span>Other user is typing...</span>
                    </div>
                </div>
                
                <div id="chatMessages" class="chat-messages">
                    <div class="welcome-message">
                        <p>Welcome to your private chat! Only you and your partner can see these messages.</p>
                    </div>
                </div>
                
                <form id="messageForm" class="message-form">
                    <div class="message-input-container">
                        <input type="text" id="messageInput" class="form-control message-input" 
                               placeholder="Type your message..." maxlength="500" required>
                        <button type="submit" class="btn btn--primary message-send-btn">Send</button>
                    </div>
                </form>
            </div>

            <!-- Instagram Sidebar -->
            <div class="instagram-section">
                <div class="instagram-header">
                    <h3>Instagram</h3>
                    <button id="toggleInstagram" class="btn btn--secondary btn--sm">Connect</button>
                </div>
                
                <div id="instagramDisconnected" class="instagram-disconnected">
                    <div class="instagram-connect">
                        <p>Connect your Instagram to share posts and reels</p>
                        <div class="form-group">
                            <label for="instagramToken" class="form-label">Access Token</label>
                            <input type="text" id="instagramToken" class="form-control" 
                                   placeholder="Enter your Instagram token">
                        </div>
                        <button id="connectInstagram" class="btn btn--primary btn--sm">Connect Instagram</button>
                    </div>
                </div>

                <div id="instagramConnected" class="instagram-connected hidden">
                    <div id="instagramProfile" class="instagram-profile"></div>
                    <div class="instagram-posts">
                        <h4>Your Posts & Reels</h4>
                        <div id="instagramFeed" class="instagram-feed"></div>
                    </div>
                </div>

                <div id="instagramLoading" class="instagram-loading hidden">
                    <p>Loading Instagram content...</p>
                </div>

                <div id="instagramError" class="error-message hidden"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <script>
      // Application Data
const APP_DATA = {
  users: [
    {"username": "user1", "password": "pass1", "displayName": "Alice"},
    {"username": "user2", "password": "pass2", "displayName": "Bob"}
  ],
  mockInstagramData: {
    "user1": {
      "profile": {
        "username": "alice_adventures",
        "followers": 1250,
        "following": 890,
        "posts": 156
      },
      "posts": [
        {
          "id": "1",
          "type": "image",
          "thumbnail": "https://picsum.photos/200/200?random=1",
          "caption": "Beautiful sunset at the beach! ðŸŒ… #sunset #beach #nature",
          "likes": 124,
          "comments": 18,
          "timestamp": "2024-10-04T10:30:00Z"
        },
        {
          "id": "2", 
          "type": "reel",
          "thumbnail": "https://picsum.photos/200/200?random=2",
          "caption": "Quick workout routine for busy mornings ðŸ’ª #fitness #workout #morning",
          "likes": 89,
          "comments": 12,
          "views": 2300,
          "timestamp": "2024-10-03T08:15:00Z"
        },
        {
          "id": "3",
          "type": "image",
          "thumbnail": "https://picsum.photos/200/200?random=3", 
          "caption": "Homemade pasta night! Recipe in bio ðŸ #cooking #pasta #foodie",
          "likes": 67,
          "comments": 8,
          "timestamp": "2024-10-02T19:45:00Z"
        }
      ]
    },
    "user2": {
      "profile": {
        "username": "bob_photographer", 
        "followers": 2100,
        "following": 456,
        "posts": 203
      },
      "posts": [
        {
          "id": "4",
          "type": "image",
          "thumbnail": "https://picsum.photos/200/200?random=4",
          "caption": "Street photography from downtown ðŸ“¸ #streetphotography #urban #city", 
          "likes": 156,
          "comments": 22,
          "timestamp": "2024-10-04T14:20:00Z"
        },
        {
          "id": "5",
          "type": "reel", 
          "thumbnail": "https://picsum.photos/200/200?random=5",
          "caption": "Behind the scenes of today's photoshoot ðŸŽ¬ #bts #photography #creative",
          "likes": 201,
          "comments": 35,
          "views": 4500,
          "timestamp": "2024-10-03T16:30:00Z"
        },
        {
          "id": "6",
          "type": "image",
          "thumbnail": "https://picsum.photos/200/200?random=6",
          "caption": "Golden hour magic âœ¨ #goldenhour #portrait #photography",
          "likes": 178,
          "comments": 19,
          "timestamp": "2024-10-02T17:00:00Z" 
        }
      ]
    }
  }
};

// Application State
let currentUser = null;
let messages = [];
let isInstagramConnected = false;
let sessionTimeout = null;
let typingTimeout = null;

// Session timeout duration (30 minutes)
const SESSION_TIMEOUT_DURATION = 30 * 60 * 1000;

// DOM Elements
let loginPage, mainApp, loginForm, loginError, currentUserSpan, logoutBtn;
let chatMessages, messageForm, messageInput, typingIndicator;
let toggleInstagram, connectInstagram, instagramToken;
let instagramDisconnected, instagramConnectedDiv, instagramLoading, instagramError;
let instagramProfile, instagramFeed, loadingOverlay;

// Initialize Application
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded');
    initializeElements();
    checkSession();
    setupEventListeners();
    
    // Check for other user activity simulation
    setInterval(simulateOtherUserActivity, 15000);
});

// Initialize DOM Elements
function initializeElements() {
    try {
        loginPage = document.getElementById('loginPage');
        mainApp = document.getElementById('mainApp');
        loginForm = document.getElementById('loginForm');
        loginError = document.getElementById('loginError');
        currentUserSpan = document.getElementById('currentUser');
        logoutBtn = document.getElementById('logoutBtn');
        chatMessages = document.getElementById('chatMessages');
        messageForm = document.getElementById('messageForm');
        messageInput = document.getElementById('messageInput');
        typingIndicator = document.getElementById('typingIndicator');
        toggleInstagram = document.getElementById('toggleInstagram');
        connectInstagram = document.getElementById('connectInstagram');
        instagramToken = document.getElementById('instagramToken');
        instagramDisconnected = document.getElementById('instagramDisconnected');
        instagramConnectedDiv = document.getElementById('instagramConnected');
        instagramLoading = document.getElementById('instagramLoading');
        instagramError = document.getElementById('instagramError');
        instagramProfile = document.getElementById('instagramProfile');
        instagramFeed = document.getElementById('instagramFeed');
        loadingOverlay = document.getElementById('loadingOverlay');
        
        console.log('All elements initialized');
    } catch (error) {
        console.error('Error initializing elements:', error);
    }
}

// Setup Event Listeners
function setupEventListeners() {
    try {
        // Login form
        if (loginForm) {
            loginForm.addEventListener('submit', handleLogin);
            console.log('Login form listener added');
        } else {
            console.error('Login form not found');
        }
        
        // Logout button
        if (logoutBtn) {
            logoutBtn.addEventListener('click', handleLogout);
        }
        
        // Message form
        if (messageForm) {
            messageForm.addEventListener('submit', handleSendMessage);
        }
        
        // Message input for typing indicator
        if (messageInput) {
            messageInput.addEventListener('input', handleTyping);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage(e);
                }
            });
        }
        
        // Instagram connection
        if (connectInstagram) {
            connectInstagram.addEventListener('click', handleConnectInstagram);
        }
        if (toggleInstagram) {
            toggleInstagram.addEventListener('click', handleToggleInstagram);
        }
        
        console.log('All event listeners set up');
    } catch (error) {
        console.error('Error setting up event listeners:', error);
    }
}

// Authentication Functions
function handleLogin(e) {
    e.preventDefault();
    console.log('Login form submitted');
    
    try {
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        
        if (!usernameInput || !passwordInput) {
            console.error('Login form inputs not found');
            return;
        }
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        console.log('Login attempt with username:', username);
        
        // Clear previous errors
        hideError(loginError);
        
        // Validate credentials
        const user = APP_DATA.users.find(u => u.username === username && u.password === password);
        
        if (user) {
            console.log('Valid user found:', user);
            showLoading();
            
            // Simulate login delay
            setTimeout(() => {
                try {
                    currentUser = user;
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    console.log('User set and saved to session:', currentUser);
                    
                    showMainApp();
                    startSessionTimeout();
                    hideLoading();
                    
                    // Clear form
                    usernameInput.value = '';
                    passwordInput.value = '';
                    
                    console.log('Login completed successfully');
                } catch (error) {
                    console.error('Error during login completion:', error);
                    hideLoading();
                    showError(loginError, 'An error occurred during login. Please try again.');
                }
            }, 1000);
        } else {
            console.log('Invalid credentials provided');
            showError(loginError, 'Invalid username or password. Please try again.');
        }
    } catch (error) {
        console.error('Error in handleLogin:', error);
        showError(loginError, 'An error occurred. Please try again.');
    }
}

function handleLogout() {
    try {
        clearSessionTimeout();
        sessionStorage.removeItem('currentUser');
        currentUser = null;
        isInstagramConnected = false;
        messages = [];
        showLoginPage();
        console.log('User logged out');
    } catch (error) {
        console.error('Error during logout:', error);
    }
}

function checkSession() {
    try {
        const savedUser = sessionStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            console.log('Session restored for user:', currentUser);
            showMainApp();
            startSessionTimeout();
        } else {
            console.log('No saved session found');
        }
    } catch (error) {
        console.error('Error checking session:', error);
        sessionStorage.removeItem('currentUser');
    }
}

function startSessionTimeout() {
    clearSessionTimeout();
    sessionTimeout = setTimeout(() => {
        alert('Session expired due to inactivity. Please login again.');
        handleLogout();
    }, SESSION_TIMEOUT_DURATION);
}

function clearSessionTimeout() {
    if (sessionTimeout) {
        clearTimeout(sessionTimeout);
        sessionTimeout = null;
    }
}

// UI Functions
function showLoginPage() {
    try {
        if (loginPage && mainApp) {
            loginPage.classList.remove('hidden');
            mainApp.classList.add('hidden');
            
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            if (usernameInput) usernameInput.value = '';
            if (passwordInput) passwordInput.value = '';
            if (loginError) hideError(loginError);
            
            console.log('Login page shown');
        }
    } catch (error) {
        console.error('Error showing login page:', error);
    }
}

function showMainApp() {
    try {
        if (loginPage && mainApp && currentUser) {
            console.log('Attempting to show main app for user:', currentUser);
            
            loginPage.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            if (currentUserSpan) {
                currentUserSpan.textContent = currentUser.displayName;
            }
            
            loadMessages();
            resetInstagramUI();
            
            console.log('Main app displayed successfully');
        } else {
            console.error('Cannot show main app - missing elements or user');
        }
    } catch (error) {
        console.error('Error showing main app:', error);
    }
}

function showLoading() {
    try {
        if (loadingOverlay) {
            loadingOverlay.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error showing loading:', error);
    }
}

function hideLoading() {
    try {
        if (loadingOverlay) {
            loadingOverlay.classList.add('hidden');
        }
    } catch (error) {
        console.error('Error hiding loading:', error);
    }
}

function showError(element, message) {
    try {
        if (element) {
            element.textContent = message;
            element.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error showing error:', error);
    }
}

function hideError(element) {
    try {
        if (element) {
            element.classList.add('hidden');
            element.textContent = '';
        }
    } catch (error) {
        console.error('Error hiding error:', error);
    }
}

// Message Functions
function handleSendMessage(e) {
    e.preventDefault();
    
    try {
        if (!messageInput || !currentUser) return;
        
        const messageText = messageInput.value.trim();
        if (!messageText) return;
        
        startSessionTimeout();
        
        const message = {
            id: Date.now(),
            text: sanitizeInput(messageText),
            sender: currentUser.username,
            senderName: currentUser.displayName,
            timestamp: new Date(),
            type: 'sent'
        };
        
        messages.push(message);
        displayMessage(message);
        messageInput.value = '';
        scrollToBottom();
        
        setTimeout(() => simulateMessageReceived(), 1000);
    } catch (error) {
        console.error('Error sending message:', error);
    }
}

function displayMessage(message) {
    try {
        if (!chatMessages) return;
        
        const messageElement = document.createElement('div');
        messageElement.className = `message message--${message.type}`;
        
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.textContent = message.text;
        
        const meta = document.createElement('div');
        meta.className = 'message-meta';
        
        const sender = document.createElement('span');
        sender.textContent = message.senderName;
        
        const timestamp = document.createElement('span');
        timestamp.textContent = formatTime(message.timestamp);
        
        meta.appendChild(sender);
        meta.appendChild(timestamp);
        
        messageElement.appendChild(bubble);
        messageElement.appendChild(meta);
        
        chatMessages.appendChild(messageElement);
    } catch (error) {
        console.error('Error displaying message:', error);
    }
}

function simulateMessageReceived() {
    try {
        if (!currentUser) return;
        
        showTypingIndicator();
        
        setTimeout(() => {
            hideTypingIndicator();
            
            const otherUser = APP_DATA.users.find(u => u.username !== currentUser.username);
            const responses = [
                "Got it! Thanks for letting me know.",
                "That sounds great!",
                "I agree with you on that.",
                "Interesting point!",
                "Let me think about that.",
                "Sure, that works for me.",
                "I'll get back to you on this.",
                "Good to know!",
                "Thanks for sharing!"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const message = {
                id: Date.now(),
                text: randomResponse,
                sender: otherUser.username,
                senderName: otherUser.displayName,
                timestamp: new Date(),
                type: 'received'
            };
            
            messages.push(message);
            displayMessage(message);
            scrollToBottom();
        }, 2000);
    } catch (error) {
        console.error('Error simulating received message:', error);
    }
}

function handleTyping() {
    startSessionTimeout();
    
    if (typingTimeout) {
        clearTimeout(typingTimeout);
    }
    
    typingTimeout = setTimeout(() => {
        // Could simulate other user typing here
    }, 1000);
}

function showTypingIndicator() {
    try {
        if (typingIndicator) {
            typingIndicator.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error showing typing indicator:', error);
    }
}

function hideTypingIndicator() {
    try {
        if (typingIndicator) {
            typingIndicator.classList.add('hidden');
        }
    } catch (error) {
        console.error('Error hiding typing indicator:', error);
    }
}

function loadMessages() {
    try {
        if (!chatMessages) return;
        
        chatMessages.innerHTML = '<div class="welcome-message"><p>Welcome to your private chat! Only you and your partner can see these messages.</p></div>';
        
        messages.forEach(message => {
            displayMessage(message);
        });
        
        scrollToBottom();
    } catch (error) {
        console.error('Error loading messages:', error);
    }
}

function scrollToBottom() {
    try {
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    } catch (error) {
        console.error('Error scrolling to bottom:', error);
    }
}

function formatTime(date) {
    return date.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit'
    });
}

function simulateOtherUserActivity() {
    try {
        if (!currentUser || !chatMessages) return;
        
        if (Math.random() < 0.2) {
            const otherUser = APP_DATA.users.find(u => u.username !== currentUser.username);
            const randomMessages = [
                "Hey, how's it going?",
                "Just checking in!",
                "What are you up to today?",
                "Hope you're having a good day!",
                "Quick question - are you free later?",
                "Thanks for the update!",
                "That's awesome news!",
                "Let me know when you're available."
            ];
            
            const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const message = {
                    id: Date.now(),
                    text: randomMessage,
                    sender: otherUser.username,
                    senderName: otherUser.displayName,
                    timestamp: new Date(),
                    type: 'received'
                };
                
                messages.push(message);
                displayMessage(message);
                scrollToBottom();
            }, 2000);
        }
    } catch (error) {
        console.error('Error in simulated user activity:', error);
    }
}

// Instagram Functions
function handleToggleInstagram() {
    try {
        if (isInstagramConnected) {
            disconnectInstagram();
        } else {
            if (instagramToken) {
                instagramToken.focus();
            }
        }
    } catch (error) {
        console.error('Error toggling Instagram:', error);
    }
}

function handleConnectInstagram() {
    try {
        if (!instagramToken) return;
        
        const token = instagramToken.value.trim();
        
        startSessionTimeout();
        hideError(instagramError);
        
        if (!token) {
            showError(instagramError, 'Please enter an Instagram access token.');
            return;
        }
        
        if (instagramDisconnected) instagramDisconnected.classList.add('hidden');
        if (instagramLoading) instagramLoading.classList.remove('hidden');
        
        setTimeout(() => {
            if (token.length >= 10) {
                connectToInstagram();
            } else {
                if (instagramLoading) instagramLoading.classList.add('hidden');
                if (instagramDisconnected) instagramDisconnected.classList.remove('hidden');
                showError(instagramError, 'Invalid access token. Please check your token and try again.');
            }
        }, 2000);
    } catch (error) {
        console.error('Error connecting to Instagram:', error);
    }
}

function connectToInstagram() {
    try {
        isInstagramConnected = true;
        
        if (instagramLoading) instagramLoading.classList.add('hidden');
        if (instagramConnectedDiv) instagramConnectedDiv.classList.remove('hidden');
        
        if (toggleInstagram) {
            toggleInstagram.textContent = 'Disconnect';
            toggleInstagram.className = 'btn btn--outline btn--sm';
        }
        
        loadInstagramProfile();
        loadInstagramFeed();
    } catch (error) {
        console.error('Error in connectToInstagram:', error);
    }
}

function disconnectInstagram() {
    try {
        isInstagramConnected = false;
        
        if (instagramConnectedDiv) instagramConnectedDiv.classList.add('hidden');
        if (instagramDisconnected) instagramDisconnected.classList.remove('hidden');
        
        if (toggleInstagram) {
            toggleInstagram.textContent = 'Connect';
            toggleInstagram.className = 'btn btn--secondary btn--sm';
        }
        
        if (instagramToken) instagramToken.value = '';
        hideError(instagramError);
    } catch (error) {
        console.error('Error disconnecting Instagram:', error);
    }
}

function loadInstagramProfile() {
    try {
        if (!currentUser || !instagramProfile) return;
        
        const userData = APP_DATA.mockInstagramData[currentUser.username];
        if (!userData) return;
        
        const profileHTML = `
            <div class="instagram-profile-info">
                <div class="instagram-username">@${userData.profile.username}</div>
                <div class="instagram-stats">
                    <div class="instagram-stat">
                        <span class="instagram-stat-value">${userData.profile.posts}</span>
                        <span>Posts</span>
                    </div>
                    <div class="instagram-stat">
                        <span class="instagram-stat-value">${userData.profile.followers.toLocaleString()}</span>
                        <span>Followers</span>
                    </div>
                    <div class="instagram-stat">
                        <span class="instagram-stat-value">${userData.profile.following}</span>
                        <span>Following</span>
                    </div>
                </div>
            </div>
        `;
        
        instagramProfile.innerHTML = profileHTML;
    } catch (error) {
        console.error('Error loading Instagram profile:', error);
    }
}

function loadInstagramFeed() {
    try {
        if (!currentUser || !instagramFeed) return;
        
        const userData = APP_DATA.mockInstagramData[currentUser.username];
        if (!userData) return;
        
        const feedHTML = userData.posts.map(post => `
            <div class="instagram-post">
                <div class="instagram-post-header">
                    <span class="instagram-post-type instagram-post-type--${post.type}">${post.type}</span>
                </div>
                <img src="${post.thumbnail}" alt="Instagram post" class="instagram-post-thumbnail" loading="lazy">
                <div class="instagram-post-content">
                    <div class="instagram-post-caption">${post.caption}</div>
                    <div class="instagram-post-stats">
                        <span>â¤ï¸ ${post.likes}</span>
                        <span>ðŸ’¬ ${post.comments}</span>
                        ${post.views ? `<span>ðŸ‘ï¸ ${post.views.toLocaleString()}</span>` : ''}
                    </div>
                </div>
            </div>
        `).join('');
        
        instagramFeed.innerHTML = feedHTML;
    } catch (error) {
        console.error('Error loading Instagram feed:', error);
    }
}

function resetInstagramUI() {
    try {
        isInstagramConnected = false;
        
        if (instagramConnectedDiv) instagramConnectedDiv.classList.add('hidden');
        if (instagramLoading) instagramLoading.classList.add('hidden');
        if (instagramDisconnected) instagramDisconnected.classList.remove('hidden');
        
        if (toggleInstagram) {
            toggleInstagram.textContent = 'Connect';
            toggleInstagram.className = 'btn btn--secondary btn--sm';
        }
        
        if (instagramToken) instagramToken.value = '';
        hideError(instagramError);
        if (instagramProfile) instagramProfile.innerHTML = '';
        if (instagramFeed) instagramFeed.innerHTML = '';
    } catch (error) {
        console.error('Error resetting Instagram UI:', error);
    }
}

// Utility Functions
function sanitizeInput(input) {
    const div = document.createElement('div');
    div.textContent = input;
    return div.innerHTML;
}

// Handle page visibility change to pause/resume activity
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        if (typingTimeout) {
            clearTimeout(typingTimeout);
        }
    } else {
        if (currentUser) {
            startSessionTimeout();
        }
    }
});

// Handle beforeunload to clear session
window.addEventListener('beforeunload', function() {
    clearSessionTimeout();
});
    </script>
</body>
</html>
